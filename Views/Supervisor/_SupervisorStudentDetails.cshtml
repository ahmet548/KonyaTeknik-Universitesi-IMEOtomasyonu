@model IMEAutomationDBOperations.Models.Student

<style>
    .btn-btn-primary {
        padding: 12px 24px;
        font-size: 1rem;
        transition: all 0.3s ease;
        cursor: pointer;
        font-weight: 500;
        color: #fff;
        display: flex;
        align-items: center;
        position: absolute;
        background-color: #4171d3;
        border-color: #4171d3;
        padding: 4px 10px;
        border-radius: 2px;
        top: 0;
        right: 0;
    }
</style>

@if (Model == null)
{
    <div class="text-center mt-5">
        <p class="text-muted">Öğrenci bulunamadı.</p>
    </div>
}
else
{
    <div class="diary-container" style="margin: 0 !important; margin-top: 20px;">
        <h3 style="font-weight: 500;">@Model.FirstName @Model.LastName</h3>
        <div class="diary-tabs-container mt-4 position-relative">
            <div class="diary-tabs">
                <div class="diary-tab active" data-tab="notes">Notlar</div>
                <div class="diary-tab" data-tab="videos">Videolar</div>
            </div>
            <div class="ms-auto"> @* Added for right alignment *@
                <button class="btn-btn-primary"
                    onclick="location.href='@Url.Action("EvaluateStudent", "Supervisor", new { studentId = Model.UserID })'">
                    Notlandır</button>
            </div>
        </div>
        <div class="diary-content">
            <div id="notes-tab" class="diary-tab-content active">
                <div class="row"> @* Added row for grid layout *@
                    @{
                        var notes = ViewBag.Notes as List<IMEAutomationDBOperations.Models.Note>;
                    }
                    @if (notes != null && notes.Any())
                    {
                        foreach (var note in notes)
                        {
                            <div class="col-md-3 mb-4"> @* Added col-md-3 for 4-column layout *@
                                <div class="diary-history-card">
                                    <div class="diary-history-card-header">
                                        <h6 class="diary-history-card-title">@note.Title</h6>
                                        <span class="diary-history-card-date">@note.CreatedAt.ToString("dd.MM.yyyy")</span>
                                    </div>
                                    @if (!string.IsNullOrEmpty(note.SubTitle))
                                    {
                                        <div class="diary-history-card-subtitle">@note.SubTitle</div>
                                    }
                                    <div class="diary-history-card-content">
                                        @Html.Raw(note.Content)
                                    </div>
                                    <button class="diary-history-card-view-btn"
                                        onclick="window.open('/Supervisor/ShowNote?noteId=@note.NoteID', '_blank')">
                                        NOTU GÖRÜNTÜLE
                                    </button>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="col-md-12"> @* Adjusted for full width in empty state *@
                            <div class="diary-history-empty text-center">
                                <img class="empty-placeholder-image-lg mt-1"
                                    src="https://lms.ktun.edu.tr/theme/image.php/remui/block_myoverview/1757327541/courses"
                                    style="width:110px; margin-bottom: 15px;" alt="">
                                <p class="text-muted">Bu öğrenciye ait not bulunmamaktadır.</p>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div id="videos-tab" class="diary-tab-content">
                <div class="row"> @* Added row for grid layout *@
                    @{
                        var videos = ViewBag.Videos as List<IMEAutomationDBOperations.Models.Video>;
                    }
                    @if (videos != null && videos.Any())
                    {
                        foreach (var video in videos)
                        {
                            <div class="col-md-3 mb-4"> @* Added col-md-3 for 4-column layout *@
                                <div class="diary-history-card">
                                    <div class="diary-history-card-header">
                                        <h6 class="diary-history-card-title">@video.Title</h6>
                                        <span class="diary-history-card-date">@video.UploadDate.ToString("dd.MM.yyyy")</span>
                                    </div>
                                    @if (!string.IsNullOrEmpty(video.Description))
                                    {
                                        <div class="diary-history-card-subtitle">@video.Description</div>
                                    }
                                    <div class="diary-history-card-content">
                                        <div class="video-info">
                                            <i class="fas fa-video me-2 text-muted"></i>
                                            <span class="text-muted">@System.IO.Path.GetFileName(video.FilePath)</span>
                                        </div>
                                    </div>
                                    <button class="diary-history-card-view-btn"
                                        onclick="openWatchVideoModal('@video.FilePath', '@video.Title.Replace("'", "\\'")')">
                                        VİDEOYU İZLE
                                    </button>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="col-md-12"> @* Adjusted for full width in empty state *@
                            <div class="diary-history-empty text-center">
                                <img class="empty-placeholder-image-lg mt-1"
                                    src="https://lms.ktun.edu.tr/theme/image.php/remui/block_myoverview/1757327541/courses"
                                    style="width:110px; margin-bottom: 15px;" alt="">
                                <p class="text-muted">Bu öğrenciye ait video bulunmamaktadır.</p>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div id="grading-tab" class="diary-tab-content">
                <div class="text-center mt-5">
                    <p class="text-muted">Öğrenciyi notlandırmak için yukarıdaki butonu kullanın.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Re-initialize tab switching for the loaded partial view
        document.querySelectorAll('.diary-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');

                // Tabs
                document.querySelectorAll('.diary-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Content
                document.querySelectorAll('.diary-tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });

        function openWatchVideoModal(filePath, title) {
            const videoPlayer = document.getElementById('videoPlayer');
            const modalLabel = document.getElementById('watchVideoModalLabel');

            // File path needs to be relative to wwwroot
            videoPlayer.src = '/' + filePath.replace(/\\/g, '/').replace('wwwroot/', '');
            modalLabel.textContent = title;

            var myModal = new bootstrap.Modal(document.getElementById('watchVideoModal'), {});
            myModal.show();
        }
    </script>
}